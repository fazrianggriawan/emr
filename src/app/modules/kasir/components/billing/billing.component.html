<div class="row">
    <div class="col-3">
        <app-tarif></app-tarif>
    </div>
    <div class="col">
        <h3>Rincian Billing</h3>
        <hr class="m-0">
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th></th>
                    <th>Nama Tarif</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Disc %</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of dataBilling; let i = index">
                    <td>
                        <button (click)="confirmDeleteBilling($event, item)" pButton pRipple type="button" icon="pi pi-times" class="p-button-sm p-button-rounded p-button-danger p-button-text"></button>
                    </td>
                    <td>
                        {{item.nama_tarif | uppercase}}
                        <div style="margin-top: -5px;" class="text-muted"><small>Tanggal: {{item.tgl_tindakan}}</small></div>
                    </td>
                    <td>{{item.harga | number}}</td>
                    <td><a class="text-primary clickable" (click)="openOpJumlah($event, item)">{{item.qty}}</a></td>
                    <td><a class="text-primary clickable" (click)="openOpDisc($event, item)">{{item.discount}}%</a></td>
                    <td>{{hitungTotalBilling(item) | number}}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-3">
        <div class="row">
            <div class="col">
                <h3>Kasir</h3>
            </div>
        </div>
        <hr class="m-0 mb-2">
        <div class="row mb-1">
            <div class="col-auto">Discount Semua Pemeriksaan (%)</div>
            <div class="col text-right">
                <a class="clickable text-primary">10%</a>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col-auto">Discount Total Billing</div>
            <div class="col text-right">
                <a class="clickable text-primary">0</a>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col-auto">Alasan Discount</div>
            <div class="col text-right">
                <a class="clickable text-primary"><i>Catatan</i></a>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col-auto">Pajak</div>
            <div class="col text-right">
                <a class="clickable text-primary">0</a>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col">
                <div class="bold">TOTAL</div>
                <div class="bg-gray-100 rounded border p-2"><h3 class="m-0">{{totalBilling | number}}</h3></div>
            </div>
            <div class="col">
                <div class="bold">TAGIHAN</div>
                <div class="bg-gray-100 rounded border p-2"><h3 class="m-0">{{tagihan | number}}</h3></div>
            </div>
        </div>
        <div class="row" *ngIf="tagihan == 0">
            <div class="col text-center">
                <div class="alert alert-success mt-2 mb-0">
                    <h3 class="m-0">LUNAS</h3>
                </div>
            </div>
        </div>
        <div class="row mt-2" *ngIf="tagihan > 0">
            <div class="col">
                <div class="mb-2">
                    <div>Cara Pembayaran</div>
                    <p-dropdown [options]="jnsBayar" [(ngModel)]="selectedJnsBayar" optionLabel="name" [style]="{width: '100%'}"></p-dropdown>
                </div>
                <div class="mb-2">
                    <div>Jumlah Bayar</div>
                    <div class="input-group">
                        <input type="text" [(ngModel)]="totalBayar" class="form-control">
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="button-addon2" *ngIf="tagihan == totalBayar" (click)="confirmAddPembayaran($event)"><i class="bi bi-check-lg mr-1"></i>Selesaikan Tagihan</button>
                          <button class="btn btn-dark" type="button" id="button-addon2" *ngIf="tagihan != totalBayar" (click)="confirmAddPembayaran($event)"><i class="bi bi-plus-lg mr-1"></i>Bayar Tagihan</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" *ngIf="dataPembayaran">
            <div class="col">
                <hr>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Cara Pembayaran</th>
                            <th>Jumlah</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of dataPembayaran">
                            <td>{{item.jnsBayar_name | uppercase}}</td>
                            <td>{{item.jumlah | number}}</td>
                            <td>
                                <button (click)="confirmDeletePembayaran($event, item)" pButton pRipple type="button" icon="pi pi-times" class="p-button-sm p-button-rounded p-button-danger p-button-text"></button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="text-right">
                    <button class="btn btn-sm btn-primary"><i class="bi bi-printer"></i> Print Bukti Pembayaran</button>
                </div>

            </div>
        </div>
        <hr>

    </div>
</div>


<p-overlayPanel #opDisc>
    <ng-template pTemplate>
        Disc %
        <div class="input-group">
            <input type="text" class="form-control" [(ngModel)]="selectedBilling.discount" placeholder="Discount %" aria-label="Discount %" aria-describedby="button-addon2">
            <div class="input-group-append">
                <button class="btn btn-primary btn-icon" type="button" (click)="addDiscount()"><i class="bi bi-check-lg"></i></button>
                <button class="btn btn-light btn-icon" type="button"><i class="bi bi-x-lg"></i></button>
            </div>
        </div>
    </ng-template>
</p-overlayPanel>

<p-overlayPanel #opJumlah>
    <ng-template pTemplate>
        Jumlah
        <div class="input-group">
            <input type="number" class="form-control"  [(ngModel)]="selectedBilling.qty" placeholder="Qty" aria-label="Qty" aria-describedby="button-addon2">
            <div class="input-group-append">
                <button class="btn btn-primary btn-icon" (click)="updateJumlah()" type="button"><i class="bi bi-check-lg"></i></button>
                <button class="btn btn-light btn-icon" type="button"><i class="bi bi-x-lg"></i></button>
            </div>
        </div>
    </ng-template>
</p-overlayPanel>

<p-confirmPopup></p-confirmPopup>